(function(b){b.fn.fanvenues=function(a){f=b.extend({},b.fn.fanvenues.defaults,a);return this.each(function(){var c=b(this);jQuery.support.cors=true;c.unbind();if(c.css("width")!="0px"){var e=c.css("width");b(c).width(e);f.width=e}else b(c).width(f.width);if(c.css("height")!="0px"){e=c.css("height");b(c).height(e);f.height=e}else b(c).height(f.height);c.bind("onReceiveVenueData",f.onReceiveVenueData);c.bind("onReceiveSectionData",f.onReceiveSectionData);e={p:f.mapSet,l:f.mapId,el:c.attr("id"),c:f.custom3d,
v:f.version};if(b.browser.msie&&window.XDomainRequest){var d=new XDomainRequest;d.open("post",A+"/getdata-2");d.onprogress=function(){};d.onload=function(){var h=eval(d.responseText);h.length>1&&c.trigger("onReceiveVenueData",[h[0],h[1],h[2]]);h.length==1&&h[0]=="fvmapNotAvailable"&&c.trigger("fvmapNotAvailable")};d.send("p="+e.p+"&l="+e.l+"&el="+e.el+"&c="+e.c+"&v="+e.v)}else b.ajax({url:A+"/getdata-2",data:e,type:"POST",success:function(h){h=eval(h);h.length>1&&c.trigger("onReceiveVenueData",[h[0],
h[1],h[2]]);h.length==1&&h[0]=="fvmapNotAvailable"&&c.trigger("fvmapNotAvailable")},error:function(){}})})};var A="http://fanvenues2.appspot.com",B,H,f,u=0,v=999999,w,g={},k={},l={},o=[],D,j,q={},y="#000000",z=0,I="#000000",J=0.5,E="#000000",F=0,p=function(a){return a.replace("'","").replace("*","").replace("`","").replace('"',"")},N=function(a){j=new google.maps.Map(a,{disableDoubleClickZoom:true,scrollwheel:f.scrollWheelZoom,scaleControl:false,disableDefaultUI:true,streetViewControl:false,mapTypeControl:false});
j.setCenter(new google.maps.LatLng(0,0,true));j.setZoom(f.defaultZoom);var c=new google.maps.ImageMapType({getTileUrl:function(e,d){for(var h=Math.pow(2,d),m=e.x,n=e.y,r="t",C=0;C<d;C++){h/=2;if(n<h)if(m<h)r+="q";else{r+="r";m-=h}else{if(m<h)r+="t";else{r+="s";m-=h}n-=h}}return tile=H+r+".jpg"},tileSize:new google.maps.Size(256,256),isPng:false,maxZoom:4,minZoom:2,name:"Fanvenues 3D Interactive Seating Maps"});j.mapTypes.set("fanvenues",c);j.setMapTypeId("fanvenues");google.maps.event.addListener(j,
"tilesloaded",function(){if(f.priceFilter){var e=b(j.getDiv());K(e)}priceFilterloaded=true});google.maps.event.addListener(j,"center_changed",function(){var e=this.getCenter().lng(),d=this.getCenter().lat();e<-60&&j.setCenter(new google.maps.LatLng(parseFloat(d),-60));e>60&&j.setCenter(new google.maps.LatLng(parseFloat(d),60));d<-90&&j.setCenter(new google.maps.LatLng(-90,parseFloat(e)));d>90&&j.setCenter(new google.maps.LatLng(90,parseFloat(e)))});b(a).append(b('<div class="section focus"></div>')).append(b('<div class="section available"></div>')).append(b('<div class="section selected"></div>'))},
O=function(a){for(var c="",e=f.ticketList.items.length,d=0;d<e;d++)c=d==e-1?c+p(f.ticketList.items[d].section)+"**"+f.ticketList.items[d].price.toString():c+p(f.ticketList.items[d].section)+"**"+f.ticketList.items[d].price.toString()+",";c={l:B,s:c};var h=b(a);if(b.browser.msie&&window.XDomainRequest){var m=new XDomainRequest;m.open("post",A+"/getsectionlist-2");m.onprogress=function(){};m.onload=function(){var n=eval("["+m.responseText+"]");h.trigger("onReceiveSectionData",n)};m.send("l="+c.l+"&s="+
c.s)}else b.post(A+"/getsectionlist-2",c,function(n){n=eval("["+n+"]");h.trigger("onReceiveSectionData",n)})},P=function(){w=b(f.rowSelector);w.hover(function(a){var c=b(this);c[0].oncontextmenu=function(){a.stopPropagation();return false};c.addClass("active");c.children().addClass("active");c=p(c.find(f.sectionSelector).text());google.maps.event.trigger(l[k[c]][0],"mousemove")},function(){var a=b(this);a.removeClass("active");a.children().removeClass("active");a=p(a.find(f.sectionSelector).text());
google.maps.event.trigger(l[k[a]][0],"mouseout")});w.mousedown(function(a){b(this).mouseup(function(){b(this).unbind("mouseup");if(a.button!=2){var c=p(b(this).find(f.sectionSelector).text());c=l[k[c]][0];var e=new google.maps.LatLngBounds;c.getPath().forEach(function(d){e.extend(d)});j.setZoom(3);j.panTo(e.getCenter())}return true})});if(f.rowsToHideOnFilterSelector!="")D=b(f.rowsToHideOnFilterSelector)},L=function(){if(o.length==0){f.rowsToHideOnFilterSelector!=""&&D.show();w.show()}else{f.rowsToHideOnFilterSelector!=
""&&D.hide();w.each(function(){var a=p(b(this).find(f.sectionSelector).text());b.inArray(k[a],o)<0?b(this).hide():b(this).show()})}},G=function(a){if("rgb".indexOf(a)===0){a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete a[0];for(var c=1;c<=3;++c){a[c]=parseInt(a[c]).toString(16);if(a[c].length==1)a[c]="0"+a[c]}return"#"+a.join("")}else return a},Q=function(a,c){var e=g[a];c=b(c);if(e.coords!=""){var d=e.coords.split("*"),h=[];for(x=0;x<d.length;x++){var m=d[x].split(",");m=new google.maps.LatLng(parseFloat(m[0]),
parseFloat(m[1]));h.push(m)}e.markers=h;if(e.markers.length>0){d="#000000";d=0;var n=new google.maps.Polygon({paths:e.markers,strokeColor:"#000000",strokeOpacity:0,strokeWeight:0,fillColor:"#000000",fillOpacity:0});if(e.section!=undefined){d=y;d=z;n.setOptions({fillColor:y,fillOpacity:z})}google.maps.event.addListener(n,"mouseout",function(){thisOptions=b.inArray(a,o)>-1?{strokeColor:"#000000",strokeOpacity:0,strokeWeight:0,fillColor:E,fillOpacity:F}:g[a].minPrice!==undefined?parseFloat(g[a].minPrice)>
parseFloat(v)||parseFloat(g[a].maxPrice)<parseFloat(u)?{strokeColor:"#000000",strokeOpacity:0,strokeWeight:0,fillColor:"#000000",fillOpacity:0}:{strokeColor:"#000000",strokeOpacity:0,strokeWeight:0,fillColor:y,fillOpacity:z}:{strokeColor:"#000000",strokeOpacity:0,strokeWeight:0,fillColor:"#000000",fillOpacity:0};this.setOptions(thisOptions);b("#"+c.attr("id")).trigger("fvmapSectionBlur",[g[a].pic+"?size="+f.ssize,g[a].name])});google.maps.event.addListener(n,"mousemove",function(){thisOptions=b.inArray(a,
o)>-1?{strokeColor:"#000000",strokeOpacity:0,strokeWeight:0,fillColor:E,fillOpacity:F}:{strokeWeight:0,strokeOpacity:0,strokeColor:"#000000",fillColor:I,fillOpacity:J};this.setOptions(thisOptions);b("#"+c.attr("id")).trigger("fvmapSectionFocus",[g[a].pic+"?size="+f.ssize,g[a].name,a])});google.maps.event.addListener(n,"rightclick",function(){b("#"+c.attr("id")).trigger("fvmapEnlargeImage",[g[a].pic+"?size="+f.lsize,g[a].name,a])});google.maps.event.addListener(n,"click",function(){if(g[a].section!=
undefined){if(b.inArray(a,o)>-1){o=b.grep(o,function(C){return C!=a});b("#"+c.attr("id")).trigger("fvmapSectionDeselect",[g[a].pic+"?size="+f.ssize,g[a].name,a])}else if(!(parseFloat(g[a].minPrice)>parseFloat(v)||parseFloat(g[a].maxPrice)<parseFloat(u))){o=[a].concat(o);if(f.interactWithTicketList){var r=g[a].sections;b("#"+c.attr("id")).trigger("fvmapSectionSelect",[g[a].pic+"?size="+f.ssize,g[a].name,a,r])}else b("#"+c.attr("id")).trigger("fvmapSectionSelect",[g[a].pic+"?size="+f.ssize,g[a].name,
a])}f.interactWithTicketList&&L()}google.maps.event.trigger(n,"mousemove")});l[a]=[n,0,0]}l[a][0].setMap(j)}else e.markers=[]},R=function(a){b(a).css("padding-bottom","2px").css("padding-right","5px");var c=b("<div></div>");b(c).css("cursor","pointer").css("text-align","center").attr("title","Visit Fanvenues.com").css("font-family","Arial,sans-serif").css("font-size","10px").append('3D Interactive Seating Maps &copy 2010, <a href="http://www.fanvenues.com">Fanvenues.com</a>');b(a).append(b(c))},S=
function(a){b(a).attr("class","priceFilter").css("height","35px").append(b('<p><label>Price range:<input type="text" class="priceSliderAmount" readonly="readonly" /></label></p><div class="priceSlider"></div>'))},T=function(a){b(a).attr("class","zoomList");b("<li />").addClass("ui-state-default ui-corner-all").attr("title","Zoom in").append(b("<span class='ui-icon ui-icon-circle-plus'></span>")).click(function(){j.getZoom()+1<=4&&j.setZoom(j.getZoom()+1)}).appendTo(b(a));b("<li />").addClass("ui-state-default ui-corner-all").attr("title",
"Zoom out").append(b("<span class='ui-icon ui-icon-circle-minus'></span>")).click(function(){j.getZoom()-1>=2&&j.setZoom(j.getZoom()-1)}).appendTo(b(a))},M=function(a){if(b(a).hasClass("fullscreen")){b(a).removeClass("fullscreen");b(a).css("position","relative");b(a).width(f.width);b(a).height(f.height);google.maps.event.trigger(j,"resize");j.setZoom(1);j.setCenter(new google.maps.LatLng(0,0,true));q.index>=q.parentElement.children().length?q.parentElement.append(b(a)):b(a).insertBefore(q.parentElement.children().get(q.index));
b("body").css("overflow","auto");window.scroll(q.x,q.y)}else{$this=b(this);q={parentElement:b(a).parent(),index:b(a).parent().children().index(b(a)),x:b(window).scrollLeft(),y:b(window).scrollTop()};b("body").append(b(a)).css("overflow","hidden");b(a).addClass("fullscreen");b(a).css("position","absolute");b(a).width(b(window).width());b(a).height(b(window).height());google.maps.event.trigger(j,"resize");j.setZoom(3);j.setCenter(new google.maps.LatLng(0,0,true));window.scroll(0,0);b(window).keyup(function(c){if(c.keyCode==
"27"){c.preventDefault();b(a).hasClass("fullscreen")&&$this.trigger("click")}})}},U=function(a,c){b(a).attr("class","actionList");f.fullscreenMapButton&&b("<li />").addClass("ui-state-default ui-corner-all").attr("title","Fullscreen / Restore").append(b("<span class='ui-icon ui-icon-arrowthick-2-ne-sw'></span>")).click(function(){M(c)}).appendTo(b(a));f.resetMapButton&&b("<li />").addClass("ui-state-default ui-corner-all").attr("id","resetMapButton").attr("title","Reset map").append(b("<span class='ui-icon ui-icon-refresh'></span>")).click(function(){for(var e=
o.length,d=0;d<e;d++)google.maps.event.trigger(l[o[0]][0],"click");o=[];for(d in l){l[d][2]=0;google.maps.event.trigger(l[d][0],"mouseout")}f.interactWithTicketList&&L();j.setCenter(new google.maps.LatLng(0,0,true));j.setZoom(f.defaultZoom)}).appendTo(b(a));f.printMapButton&&b("<li />").addClass("ui-state-default ui-corner-all").attr("title","Print map").append(b("<span class='ui-icon ui-icon-print'></span>")).click(function(){b(c).hasClass("fullscreen")||M(c);j.setZoom(2);setTimeout('window.print(); alert("Done printing. Click Fullscreen button to go back to listing.");',
2E3)}).appendTo(b(a));b(a).children().hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")})},K=function(a){a.find(".priceSlider").slider({range:true,min:0,max:405,step:5,values:[0,405],slide:function(c,e){if(e.values[1]==405){a.find(".priceSliderAmount").val("$"+e.values[0]+" - $Max");b.fn.fanvenues.filter(e.values[0],999999);u=e.values[0];v=999999}else{a.find(".priceSliderAmount").val("$"+e.values[0]+" - $"+e.values[1]);b.fn.fanvenues.filter(e.values[0],
e.values[1]);u=e.values[0];v=e.values[1]}}});a.find(".priceSliderAmount").val("$"+a.find(".priceSlider").slider("values",0)+" - $Max")};b.fn.fanvenues.setZoom=function(a){a>=2&&a<=4&&j.setZoom(a)};b.fn.fanvenues.filter=function(a,c){for(t in g){var e=g[t];u=a;v=c;if(b.inArray(t,o)<0)if(e.section!=undefined)if(parseFloat(e.minPrice)>parseFloat(c)||parseFloat(e.maxPrice)<parseFloat(a)){e=l[t][0];hideOptions={strokeColor:"#000000",strokeOpacity:0,strokeWeight:0,fillColor:"#000000",fillOpacity:0};e.setOptions(hideOptions)}else{e=
l[t][0];showOptions={strokeColor:"#000000",strokeOpacity:0,strokeWeight:0,fillColor:y,fillOpacity:z};e.setOptions(showOptions)}}};b.fn.fanvenues.focusSection=function(a){a=p(a);if(k[a]!=undefined)google.maps.event.trigger(l[k[a]][0],"mousemove");else{a=a.replace(" ","-").toLowerCase();l[a][0]!=undefined&&google.maps.event.trigger(l[a][0],"mousemove")}};b.fn.fanvenues.blurSection=function(a){a=p(a);if(k[a]!=undefined)google.maps.event.trigger(l[k[a]][0],"mouseout");else{a=a.replace(" ","-").toLowerCase();
l[a][0]!=undefined&&google.maps.event.trigger(l[a][0],"mouseout")}};b.fn.fanvenues.clickSection=function(a){a=p(a);if(k[a]!=undefined)google.maps.event.trigger(l[k[a]][0],"click");else{a=a.replace(" ","-").toLowerCase();l[a][0]!=undefined&&google.maps.event.trigger(l[a][0],"click")}};b.fn.fanvenues.getLargeImage=function(a){a=p(a);if(k[a]!=undefined)return g[k[a]].pic+"?size="+f.lsize;else{a=a.replace(" ","-").toLowerCase();if(l[a][0]!=undefined)return g[a].pic+"?size="+f.lsize}};b.fn.fanvenues.getSmallImage=
function(a){a=p(a);if(k[a]!=undefined)return g[k[a]].pic+"?size="+f.ssize;else{a=a.replace(" ","-").toLowerCase();if(l[a][0]!=undefined)return g[a].pic+"?size="+f.ssize}};b.fn.fanvenues.getOriginalSectionNamesFor=function(a){var c=[];for(s in k)k[s]==a&&c.push(s);return c};b.fn.fanvenues.getLayoutId=function(){return B};b.fn.fanvenues.getAllSections=function(){var a=[];for(i in g)a.push(i);return a};b.fn.fanvenues.defaults={version:"2.1.5",defaultZoom:2,height:500,width:500,mapSet:"fv",mapId:"1004",
ticketList:{},rowSelector:"#tixlist div.tixlist-row",sectionSelector:".psection",rowsToHideOnFilterSelector:"#tbl .pHeader",zoomMapButton:true,fullscreenMapButton:true,centerMapButton:true,resetMapButton:true,closeAllBubblesButton:true,printMapButton:true,priceFilter:true,interactWithTicketList:true,custom3d:"fanvenues",scrollWheelZoom:false,lsize:"745x400",ssize:"175x94",onReceiveVenueData:function(a,c,e,d){B=e;d="http://fanvenues3.appspot.com";H=d+"/tile/"+B+"/";g=c;N(this);O(this);f.interactWithTicketList&&
P(this);a=document.createElement("ul");new U(a,this);j.controls[google.maps.ControlPosition.TOP_RIGHT].push(a);if(f.priceFilter){a=document.createElement("div");new S(a);j.controls[google.maps.ControlPosition.BOTTOM].push(a)}if(f.zoomMapButton){a=document.createElement("ul");new T(a);j.controls[google.maps.ControlPosition.LEFT].push(a)}a=document.createElement("div");new R(a);j.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push(a)},onReceiveSectionData:function(a,c){if(c!="NA"){for(s in c){var e=
s.split("**"),d=p(s.split("**")[0]),h=0;if(e.length>1)h=parseFloat(s.split("**")[1]);k[d]=c[s];if(g[k[d]]!=undefined){g[k[d]].section=d;for(e=0;e<f.ticketList.items.length;e++){var m=f.ticketList.items[e];if(m.section.toLowerCase()==d.toLowerCase())if(g[k[d]].sections==undefined)g[k[d]].sections=[m];else g[k[d]].sections.push(m)}if(g[k[d]].minPrice==undefined){g[k[d]].minPrice=h;g[k[d]].maxPrice=h}else{if(h<g[k[d]].minPrice)g[k[d]].minPrice=h;if(h>g[k[d]].maxPrice)g[k[d]].maxPrice=h}}}d=b(this);if(d.find(".section.focus").css("color")!=
null)I=G(d.find(".section.focus").css("color"));if(d.find(".section.focus").css("opacity")!=null)J=parseFloat(d.find(".section.focus").css("opacity"));if(d.find(".section.available").css("color")!=null)y=G(d.find(".section.available").css("color"));if(d.find(".section.available").css("opacity")!=null)z=parseFloat(d.find(".section.available").css("opacity"));if(d.find(".section.selected").css("color")!=null)E=G(d.find(".section.selected").css("color"));if(d.find(".section.selected").css("opacity")!=
null)F=parseFloat(d.find(".section.selected").css("opacity"));for(id in g)Q(id,this);f.priceFilter&&K(d);d.trigger("fvmapReady")}}}})(jQuery);
